<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/general :: head}"></head>

<body>

<header th:insert="~{fragments/navbar :: guest-ul}"></header>

<main>

    <div class="mx-auto w-25"   th:object="${articleEditLang}">
        <input name="id" type="hidden" th:field="*{id}"/>
        <div class="form-group">
            <label for="title" th:text="#{article.title}"></label>
            <input type="text" class="form-control"
                   th:field="*{title}"  th:value="${articleEditLang.title}"
                   id="title" th:placeholder="#{article.title}+'...'" name="title"
                   required pattern="^.{2,}$"  title="Please enter at least 2 characters">

        </div>

        <div class="form-group">
            <label for="content" th:text="#{article.content}"></label>
            <input type="text" class="form-control"
                   th:field="*{content}"  th:value="${articleEditLang.content}"
                   id="content" th:placeholder="#{article.content}" name="content"
                   required pattern="^.{2,}$"  title="Please enter at least 2 characters">

        </div>

        <div class="button-holder mt-4 d-flex justify-content-center">
            <input type="hidden" name="lang"  th:value="${#strings.arraySplit(#request.getRequestURI(),'/')[5]}" />
            <button id="submit-button" class="btn btn-success" th:text="#{edit}"></button>
        </div>
    </div>
</main>

<footer th:replace="~{fragments/general :: footer}"></footer>


<script>
    $(document).ready(()=>{
        const button=document.getElementById("submit-button");
        button.onclick=function () {
            const inputs=document.querySelectorAll('main input');
            var data = {};
            inputs.forEach(i=>{
                data[i.name]=i.value;
            });

            var json = JSON.stringify(data);

            var xhttp = new XMLHttpRequest();
            xhttp.open('PATCH', '/en/admin/articles/edit', true);
            xhttp.setRequestHeader('Content-type','application/json; charset=utf-8');
            xhttp.onreadystatechange= function(){
                if(this.readyState==4){
                    console.log(this.response);
                    window.location=this.response;
                }
            };
            xhttp.send(json);
        };
    });

</script>

</body>
</html>